generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                         String                  @id @default(auto()) @map("_id") @db.ObjectId
  fullName                   String
  email                      String                  @unique
  password                   String?
  role                       UserRoleEnum            @default(MEMBER)
  status                     UserStatus              @default(PENDING)
  isVerified                 Boolean                 @default(false)
  isProfileComplete          Boolean                 @default(false)
  address                    String?
  latitude                   Float?
  longitude                  Float?
  isLoggedIn                 Boolean                 @default(false)
  bio                        String?
  gymId                      String?
  gymName                    String?
  fitnessGoals               String[]
  image                      String?
  phoneNumber                String?
  dateOfBirth                String?
  gender                     String?
  plateForm                  PlatFormType?
  fcmToken                   String?
  fcmTokenEx                 String?
  isDeleted                  Boolean                 @default(false)
  isVerifiedForPasswordReset Boolean                 @default(false)
  stripeCustomerId           String?
  stripeAccountUrl           String?
  stripeAccountId            String?
  stripeSubscriptionId       String?
  onBoarding                 Boolean                 @default(false)
  subscriptionPlan           SubscriptionPlanStatus?
  isSubscribed               Boolean                 @default(false)
  subscriptionEnd            DateTime?
  createdAt                  DateTime                @default(now())
  updatedAt                  DateTime                @updatedAt

  // Relationships
  review             Review[]
  faq                Faq[]
  termAndCondition   TermAndCondition[]
  privacyPolicy      PrivacyPolicy[]
  notification       Notification[]
  payment            Payment[]
  category           Category[]
  aboutUs            AboutUs[]
  helpAndSupport     HelpAndSupport[]
  Reply              Reply[]
  admin              Admin?
  favoriteProduct    FavoriteProduct[]
  foundingTeam       FoundingTeam[]
  contactUsInfo      ContactUsInfo[]
  trainers           Trainer[]
  appliedReferrals   AppliedReferral[]
  serviceTypes       ServiceTypes[]
  specialties        Specialties[]
  referrals          Referral[]
  socialAccounts     SocialAccount[]
  posts              Post[]
  likes              Like[]
  comments           Comment[]
  shares             Share[]
  postImpressions    PostImpression[]
  products           Product[]
  favoriteTrainers   FavoriteTrainer[]
  subscriptionOffers SubscriptionOffer[]
  userSubscriptions  UserSubscription[]

  @@map("users")
}

model Admin {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  userId       String       @unique @db.ObjectId
  role         UserRoleEnum @default(SUPER_ADMIN)
  isSuperAdmin Boolean      @default(false)
  systemOwner  Boolean      @default(false)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("admins")
}

model Trainer {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @unique @db.ObjectId
  specialtyId     String?  @db.ObjectId
  portfolio       String[]
  certifications  String[]
  experienceYears Int
  totalReferrals  Int      @default(0)
  views           Int      @default(0)
  ratingCount     Int      @default(0)
  avgRating       Float    @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  user                User                 @relation(fields: [userId], references: [id])
  specialty           Specialties?         @relation(fields: [specialtyId], references: [id])
  trainerServiceTypes TrainerServiceType[]
  favoriteTrainer     FavoriteTrainer[]
  trainerSpecialties  TrainerSpecialty[]

  @@map("trainers")
}

model ServiceTypes {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  serviceName String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  user                User                 @relation(fields: [userId], references: [id])
  trainerServiceTypes TrainerServiceType[]

  @@map("service_types")
}

model TrainerServiceType {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  trainerId     String   @db.ObjectId
  serviceTypeId String   @db.ObjectId
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationships 
  trainer     Trainer      @relation(fields: [trainerId], references: [userId])
  serviceType ServiceTypes @relation(fields: [serviceTypeId], references: [id])

  @@unique([trainerId, serviceTypeId])
  @@map("trainer_service_types")
}

model Specialties {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  specialtyName String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationships
  user               User               @relation(fields: [userId], references: [id])
  trainer            Trainer[]
  trainerSpecialties TrainerSpecialty[]

  @@map("specialties")
}

model TrainerSpecialty {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  trainerId   String   @db.ObjectId
  specialtyId String   @db.ObjectId
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  trainer   Trainer     @relation(fields: [trainerId], references: [userId])
  specialty Specialties @relation(fields: [specialtyId], references: [id])

  @@unique([trainerId, specialtyId])
  @@map("trainer_specialties")
}

model Referral {
  id               String            @id @default(auto()) @map("_id") @db.ObjectId
  userId           String            @db.ObjectId
  referralCode     String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  appliedReferrals AppliedReferral[]

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@unique([referralCode, userId]) // prevent duplicate referrals
  @@map("referrals")
}

model AppliedReferral {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  userId       String   @db.ObjectId
  referralId   String   @db.ObjectId
  referralCode String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  referral Referral @relation(fields: [referralId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([referralCode, userId]) // prevent duplicate applied referrals
  @@map("applied_referrals")
}

model Post {
  id      String  @id @default(auto()) @map("_id") @db.ObjectId
  userId  String  @db.ObjectId
  content String
  image   String?

  likeCount    Int @default(0)
  commentCount Int @default(0)
  shareCount   Int @default(0)

  engagementCount Int @default(0)

  impressionCount Int     @default(0)
  reachCount      Int     @default(0)
  isPublished     Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user            User             @relation(fields: [userId], references: [id])
  likes           Like[]
  comments        Comment[]
  shares          Share[]
  postImpressions PostImpression[]

  @@map("posts")
}

model Like {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  postId String @db.ObjectId
  userId String @db.ObjectId

  post Post @relation(fields: [postId], references: [id])
  user User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([postId, userId]) // one like per user per post
  @@map("likes")
}

model Comment {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  postId    String   @db.ObjectId
  userId    String   @db.ObjectId
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post Post @relation(fields: [postId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@map("comments")
}

model Share {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  postId    String   @db.ObjectId
  userId    String   @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post Post @relation(fields: [postId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@map("shares")
}

model PostImpression {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  postId    String   @db.ObjectId
  userId    String   @db.ObjectId
  date      DateTime // store start of day (UTC)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post Post @relation(fields: [postId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@unique([postId, userId, date])
  @@map("post_impressions")
}

model SocialAccount {
  id           String             @id @default(auto()) @map("_id") @db.ObjectId
  userId       String             @db.ObjectId
  platformType SocialPlatformType
  platformUrl  String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, platformType]) // one platform per user
  @@map("social_accounts")
}

model Category {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  name      String   @unique
  iconUrl   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user           User             @relation(fields: [userId], references: [id])
  deletedProduct DeletedProduct[]
  // carProductMapping CarProductMapping[]

  @@map("categories")
}

model Product {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @db.ObjectId
  productName     String
  productImage    String
  productVideo    String?
  week            Int
  maxDiscountUser Int?
  agreement       String?
  pdf             String?
  isActive        Boolean  @default(false)
  price           Float
  capacity        Int?
  discount        Float    @default(0)
  ratingCount     Int      @default(0)
  avgRating       Float    @default(0)
  totalPurchased  Int      @default(0)
  views           Int      @default(0)
  description     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  user             User              @relation(fields: [userId], references: [id])
  reviews          Review[]
  favoriteProducts FavoriteProduct[]

  @@map("products")
}

model DeletedProduct {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  productId     String?  @db.ObjectId
  sellerId      String   @db.ObjectId
  categoryId    String?  @db.ObjectId
  productName   String
  productImages String[]
  description   String?
  price         Float
  discount      Float    @default(0)
  deletedAt     DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationships
  category Category? @relation(fields: [categoryId], references: [id])

  @@map("deleted_products")
}

model FavoriteProduct {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  productId String   @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@unique([userId, productId]) // prevent duplicate favorites
  @@map("favorite_products")
}

model FavoriteTrainer {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  trainerId String   @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user    User    @relation(fields: [userId], references: [id])
  trainer Trainer @relation(fields: [trainerId], references: [userId])

  @@unique([userId, trainerId]) // prevent duplicate favorites
  @@map("favorite_trainers")
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  title     String
  body      String
  data      String?
  isRead    Boolean  @default(false)
  isClicked Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model SubscriptionOffer {
  id              String                 @id @default(auto()) @map("_id") @db.ObjectId
  userId          String                 @db.ObjectId
  title           String
  description     String?
  price           Float
  currency        String?                @default("usd")
  duration        SubscriptionType
  planType        SubscriptionPlanStatus @default(TRAINER_PRO)
  status          UserStatus             @default(ACTIVE)
  stripeProductId String?
  stripePriceId   String?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt

  // Relationships
  creator          User               @relation(fields: [userId], references: [id])
  UserSubscription UserSubscription[]

  @@map("subscription_offers")
}

model UserSubscription {
  id                   String        @id @default(auto()) @map("_id") @db.ObjectId
  userId               String        @db.ObjectId
  subscriptionOfferId  String        @db.ObjectId
  startDate            DateTime      @default(now())
  endDate              DateTime
  stripeSubscriptionId String?       @unique
  paymentStatus        PaymentStatus @default(PENDING)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt

  // Relationships
  user              User              @relation(fields: [userId], references: [id])
  subscriptionOffer SubscriptionOffer @relation(fields: [subscriptionOfferId], references: [id])

  @@map("user_subscriptions")
}

model Payment {
  id                   String        @id @default(auto()) @map("_id") @db.ObjectId
  userId               String        @db.ObjectId
  paymentIntentId      String?
  paymentMethodId      String?
  stripeSubscriptionId String?
  invoiceId            String?
  paymentAmount        Float
  paymentDate          DateTime      @default(now())
  amountProvider       String
  invoice              Json?
  status               PaymentStatus @default(PENDING)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("payments")
}

model Review {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  productId String   @db.ObjectId
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@map("reviews")
}

model PrivacyPolicy {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  heading   String?
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("privacy_policies")
}

model Faq {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  question  String
  answer    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("faqs")
}

model AboutUs {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  heading   String?
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("about_us")
}

model ContactUsInfo {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  email       String
  phoneNumber String
  location    String?
  facebook    String?
  instagram   String?
  twitter     String?
  linkedin    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("contact_us_info")
}

model HelpAndSupport {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  heading   String?
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("help_and_support")
}

model TermAndCondition {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  heading   String?
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("terms_and_conditions")
}

model NewsletterSubscriber {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("newsletter_subscribers")
}

model Support {
  id        String        @id @default(auto()) @map("_id") @db.ObjectId
  userName  String?
  userEmail String
  userPhone String?
  message   String
  status    SupportStatus @default(OPEN)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  // Relationships

  reply Reply[]

  @@map("supports")
}

model Reply {
  id        String      @id @default(auto()) @map("_id") @db.ObjectId
  userId    String      @db.ObjectId
  supportId String?     @db.ObjectId
  message   String
  status    ReplyStatus @default(CLOSED)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relationships
  support Support? @relation(fields: [supportId], references: [id])
  user    User     @relation(fields: [userId], references: [id])

  @@map("replies")
}

model FoundingTeam {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  name      String
  role      String
  image     String?
  linkedin  String?
  twitter   String?
  instagram String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("founding_team")
}

enum UserRoleEnum {
  ADMIN
  SUPER_ADMIN
  TRAINER
  MEMBER
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED
}

enum ResponseStatus {
  SUBMITTED // Response submitted
  AUTO_GRADED // MCQ/TrueFalse graded
  MANUAL_GRADED // Short answer graded by instructor
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CASH
  EXPIRED
  REFUNDED
  REQUIRES_CAPTURE
  CANCELLED
}

enum SubscriptionType {
  WEEKLY
  MONTHLY
  YEARLY
  LIFETIME
}

enum SubscriptionPlanStatus {
  FREE
  TRAINER_PRO
}

enum SocialPlatformType {
  LINKEDIN
  FACEBOOK
  X
}

enum PlatFormType {
  GOOGLE
  FACEBOOK
  APPLE
}

enum ReplyStatus {
  PENDING
  IGNORED
  RESOLVED
  CLOSED
}

enum ReplyType {
  SUPPORT
  REPORT
}

enum RoomType {
  ONE_TO_ONE
  GROUP
}

enum SupportStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum UserStatus {
  ACTIVE
  PENDING
  BLOCKED
}
